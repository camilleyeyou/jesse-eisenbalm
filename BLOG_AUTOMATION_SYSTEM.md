# Blog Automation System
## Jesse A. Eisenbalm — AI-Powered Content Pipeline

---

## Overview

A standalone automation project that generates, reviews, and publishes SEO-optimised blog posts to `jesseaeisenbalm.com/blog` on a daily schedule. Content is generated by OpenAI, images by Gemini, and the final post is submitted to the existing blog API. A web dashboard provides visibility and control over the entire pipeline.

---

## System Architecture

```
┌─────────────────────────────────────────────────────────┐
│                      DASHBOARD                          │
│   Topic Queue │ Schedule │ Review Queue │ Post History   │
└──────────────────────────┬──────────────────────────────┘
                           │ triggers
                           ▼
              ┌────────────────────────┐
              │    SUPERVISOR AGENT    │  ← orchestrates all agents
              │       (GPT-4o)         │    validates final output
              └────┬───────────────────┘
                   │
       ┌───────────┼───────────────┐
       ▼           ▼               ▼
┌──────────┐ ┌──────────┐  ┌──────────────┐
│   SEO    │ │ REVISION │  │    IMAGE     │
│ CONTENT  │ │  AGENT   │  │  GENERATOR   │
│  AGENT   │ │ (GPT-4o) │  │   AGENT      │
│ (GPT-4o) │ └──────────┘  │  (Gemini)    │
└──────────┘               └──────────────┘
       │                          │
       └──────────────────────────┘
                    │ POST /api/posts
                    ▼
       Jesse A. Eisenbalm Blog API
       (jesse-eisenbalm-server.vercel.app)
                    │
                    ▼
            Supabase (posts table)
            Supabase Storage (post-images bucket)
                    │
                    ▼
        jesseaeisenbalm.com/blog
```

---

## The Four Agents

### 1. SEO Content Generator Agent
**Model:** OpenAI GPT-4o
**Role:** Produces the first draft of each blog post

**Inputs:**
- Topic / keyword cluster (from scheduler or dashboard queue)
- Focus keyphrase (the primary keyword to optimise for)
- Brand voice guidelines (see Brand Context below)
- List of existing post titles (to avoid repetition)
- Target word count (default: 900–1200 words)

**Outputs:**
- `title` — 50–60 characters, contains focus keyphrase, brand-aligned
- `excerpt` — 150–160 characters, contains focus keyphrase, Google meta description
- `content` — Full HTML body with proper structure (see Content Requirements below)
- `tags` — 2–4 relevant tags (e.g. `["mindfulness", "lip care", "ritual"]`)
- `focus_keyphrase` — echoed back for Revision Agent validation

**System prompt focus:**
- Write in the brand voice: calm, minimal, human, slightly philosophical
- Include the focus keyphrase in: title, first paragraph, at least one H2, naturally 3–5× total
- Use proper heading hierarchy (`<h2>` for sections, `<h3>` for subsections)
- Include at least 1 internal link to `https://jesseaeisenbalm.com` (product CTA)
- Include at least 1 external link to a credible source (study, publication, etc.)
- All `<img>` tags must have descriptive `alt` attributes
- Never use AI-sounding filler phrases ("In today's fast-paced world...")
- End with a CTA paragraph linking to `https://jesseaeisenbalm.com`

**Content Requirements (Yoast SEO Standard):**
```
Minimum word count:  300 words  (red below this)
Target word count:   900+ words (best for rankings)
Focus keyphrase density: 0.5–3% of total words
Title length:        50–60 characters
Excerpt length:      150–160 characters
H2 subheadings:      Required (at least 1)
Keyphrase in title:  Required
Keyphrase in excerpt: Required
Keyphrase in intro:  Required (first <p>)
Keyphrase in H2:     Required (at least 1 heading)
Internal links:      Required (≥1 link to jesseaeisenbalm.com)
External links:      Recommended (≥1 link to credible source)
Image alt text:      All <img> tags must have non-empty alt=""
```

---

### 2. Revision Agent
**Model:** OpenAI GPT-4o
**Role:** Reviews the draft against Yoast SEO standards, scores it, and returns an improved version

**Checks performed (mirrors live admin SEO panel):**

| Group | Check | Target | Severity |
|---|---|---|---|
| **Keyphrase** | Keyphrase in title | Must contain keyphrase | Required |
| **Keyphrase** | Keyphrase in URL slug | Slug contains keyphrase | Recommended |
| **Keyphrase** | Keyphrase in meta description | Excerpt contains keyphrase | Required |
| **Keyphrase** | Keyphrase in first paragraph | First `<p>` contains keyphrase | Recommended |
| **Keyphrase** | Keyphrase in H2 subheading | At least 1 `<h2>` contains keyphrase | Recommended |
| **Keyphrase** | Keyphrase density | 0.5–3% of total words | Required |
| **Content** | Word count | ≥300 (target 900+) | Required |
| **Content** | H2 subheadings present | At least 1 `<h2>` | Required |
| **Content** | Title length | 50–60 characters | Recommended |
| **Content** | Excerpt length | 150–160 characters | Required |
| **Links** | Internal links | ≥1 link to jesseaeisenbalm.com | Required |
| **Links** | External links | ≥1 link to credible source | Recommended |
| **Images** | Alt text on all images | All `<img>` have non-empty alt | Required |

**Outputs:**
- Revised `title`, `excerpt`, `content`, `tags`
- `confidence_score` (0–100) — passed to Supervisor for publish/hold decision
- `revision_notes` — log of what was changed and which checks failed/passed
- `seo_checks_passed` — count of checks passed out of 13

**Scoring guidance:**
- 13/13 checks → confidence ≥ 90
- 11–12/13 → confidence 75–89
- 9–10/13 → confidence 60–74 (likely held for review)
- < 9/13 → confidence < 60 (held, do not publish)

**Rule:** If `confidence_score < 70`, Supervisor routes to human review queue instead of publishing.

---

### 3. Image Generator Agent
**Model:** Google Gemini (Imagen 3 via Vertex AI, or `gemini-2.0-flash-preview-image-generation`)
**Role:** Creates a cover image that matches the post's tone and brand aesthetic

**Inputs:**
- Post title
- Post excerpt
- Brand aesthetic prompt suffix (appended to every generation — see below)

**Brand aesthetic prompt suffix:**
```
Minimal, clean, luxury skincare aesthetic. Muted tones — off-white, warm beige,
soft black. No text overlays. Cinematic lighting. Product photography or abstract
natural texture. No people. 16:9 aspect ratio.
```

**Outputs:**
- Raw image buffer → uploaded to Supabase Storage bucket `post-images`
- File path: `{timestamp}-{random}.jpg` (flat, collision-safe)
- Returns public URL → passed as `cover_image` in the final post payload

**Upload endpoint (existing server):**
```
POST /api/admin/upload
Header: x-admin-password: {ADMIN_PASSWORD}
Body: multipart/form-data, field name: "file"
Response: { url: "https://...supabase.co/storage/v1/object/public/post-images/..." }
```

**Supabase Storage bucket:** `post-images` (public, already created)
**Max file size:** 10MB
**Accepted types:** image/jpeg, image/png, image/webp

---

### 4. Supervisor Agent
**Model:** OpenAI GPT-4o
**Role:** Orchestrates the full pipeline, validates output, makes publish/hold/discard decision

**Workflow it manages:**
1. Receive topic + focus keyphrase from scheduler or dashboard
2. Call SEO Content Generator → get draft
3. Call Revision Agent → get improved draft + confidence score + seo_checks_passed
4. If `confidence_score >= 70`: call Image Generator → upload → get cover image URL
5. Validate final payload against schema (all required fields present, lengths correct)
6. Decision:
   - `confidence_score >= 85` → **auto-publish** (`POST /api/posts` with `published: true`)
   - `confidence_score 70–84` → **save as draft** (`POST /api/posts` with `published: false`), flag in dashboard
   - `confidence_score < 70` → **hold for human review**, do not POST
7. Log result to dashboard with `seo_checks_passed`, `revision_notes`, confidence score

**Supervisor also handles:**
- Retry logic (up to 2 retries if an agent fails)
- Error capture and dashboard notification
- Daily topic selection (pulls next topic from queue, or auto-generates a topic using brand keyword bank if queue is empty)

---

## Workflow — Step by Step

```
SCHEDULE TRIGGER (daily cron) or MANUAL TRIGGER (dashboard)
    │
    ▼
Supervisor: pick next topic + focus keyphrase from queue
    │
    ▼
SEO Content Generator: write draft (Yoast-compliant HTML)
    │
    ▼
Revision Agent: audit all 13 SEO checks → score draft
    │
    ├── confidence < 70 ──► HOLD: add to human review queue
    │
    ▼
Image Generator: create cover image → POST /api/admin/upload → get URL
    │
    ▼
Supervisor: validate final payload
    │
    ├── confidence 70–84 ──► POST /api/posts { published: false }  (draft)
    │
    └── confidence 85+  ──► POST /api/posts { published: true }   (live)
    │
    ▼
Dashboard: log result (status / score / checks passed / revision notes)
```

---

## API Integration

### Automation (API key auth)
Used by the automation system to publish posts programmatically.

**Endpoint:** `POST https://jesse-eisenbalm-server.vercel.app/api/posts`
**Auth:** `x-api-key: {BLOG_API_KEY}` header

```json
{
  "title": "Why Beeswax Lip Balm Is the Last Human Ritual",
  "excerpt": "In a world of screens and algorithms, applying beeswax lip balm has become a rare moment of genuine presence. Here is why this ritual matters now more than ever.",
  "content": "<h2>The Ritual of Presence</h2><p>...</p>",
  "author": "Jesse A. Eisenbalm",
  "cover_image": "https://kqyiauyahlmruyblxezp.supabase.co/storage/v1/object/public/post-images/1738000000000-abc123.jpg",
  "tags": ["mindfulness", "ritual", "beeswax lip balm"],
  "published": true
}
```

**Response:** `{ post: { id, slug, title, created_at, ... } }`

### Image Upload (Admin password auth)
Used by the Image Generator Agent to upload cover images to Supabase Storage.

**Endpoint:** `POST https://jesse-eisenbalm-server.vercel.app/api/admin/upload`
**Auth:** `x-admin-password: {ADMIN_PASSWORD}` header
**Body:** `multipart/form-data`, field `file`

```bash
curl -X POST https://jesse-eisenbalm-server.vercel.app/api/admin/upload \
  -H "x-admin-password: YOUR_ADMIN_PASSWORD" \
  -F "file=@cover.jpg"
# Response: { "url": "https://...supabase.co/storage/v1/object/public/post-images/..." }
```

---

## Dashboard Features

### Topic Queue
- Add topics + focus keyphrases manually or bulk-import a CSV
- Mark topics as pending / in-progress / published / held / discarded
- Auto-generate topics from keyword bank when queue is empty

### Schedule
- Set daily run time (default: 6:00 AM)
- Enable / disable auto-publishing
- View next scheduled run

### Review Queue
- Posts held for human review (confidence < 70 or SEO checks < 9/13)
- Preview rendered post content
- View SEO check results and revision notes
- Edit title / excerpt / content before approving
- One-click approve (publishes via `POST /api/posts`) or discard

### Post History
- All generated posts with status, confidence score, SEO checks passed, revision notes
- Link to live post on jesseaeisenbalm.com
- Regenerate option (re-runs full pipeline with same topic + keyphrase)

---

## Brand Context (Injected into Every Agent)

```
Brand: Jesse A. Eisenbalm
Product: Premium limited-edition beeswax lip balm. Release 001. $8.99. Hand-numbered.
Mission: Keep humans human in an AI-driven world.
Ritual: Stop. Breathe. Balm.
Tone: Calm. Minimal. Philosophical. Never corporate. Never hyperbolic.
Audience: Thoughtful adults who value mindfulness, quality, and intentional living.
Avoid: AI buzzwords, excessive exclamation points, hollow wellness clichés.
CTA target: https://jesseaeisenbalm.com
Internal link anchor examples: "shop the balm", "Jesse A. Eisenbalm", "try it here"
```

---

## Keyword Bank (Seed Topics)

Each entry should also include a suggested focus keyphrase. The Supervisor draws from this bank when the queue is empty:

| Topic | Focus Keyphrase |
|---|---|
| The science of beeswax and why it outperforms synthetic wax | beeswax lip balm benefits |
| What lip care rituals look like across different cultures | lip care ritual |
| Why limited-edition products feel more meaningful | limited edition lip balm |
| The philosophy of "enough" in a world of excess | mindful consumption |
| How to build a morning ritual that actually sticks | morning ritual routine |
| The connection between dry lips and dehydration | dry lips causes |
| What it means to give to charity through everyday purchases | charity lip balm |
| Staying present in meetings, on calls, in life | staying present mindfulness |
| Why natural ingredients matter more than ever | natural lip balm ingredients |
| The hidden cost of convenience culture | natural skincare benefits |

---

## Tech Stack Recommendation

| Layer | Technology |
|---|---|
| Runtime | Node.js 20+ |
| Agent orchestration | LangChain.js or custom async pipeline |
| Scheduler | `node-cron` |
| Dashboard backend | Express.js |
| Dashboard frontend | React + Tailwind (match brand style) or Next.js |
| OpenAI | `openai` npm package (GPT-4o) |
| Gemini | `@google/generative-ai` npm package |
| Image upload | Server's `POST /api/admin/upload` endpoint (uses Supabase Storage internally) |
| Task/queue storage | Supabase `automation_queue` table (reuse existing project) |
| Logging | Supabase `automation_logs` table |
| Hosting | Vercel (dashboard frontend) + Vercel serverless (backend) |

---

## Supabase Tables (Add to Existing Project)

```sql
-- Topic queue (includes focus keyphrase per topic)
CREATE TABLE automation_queue (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  topic TEXT NOT NULL,
  focus_keyphrase TEXT,
  keywords TEXT[],
  status TEXT DEFAULT 'pending', -- pending | in_progress | published | held | discarded
  created_at TIMESTAMPTZ DEFAULT now(),
  processed_at TIMESTAMPTZ
);

-- Run logs
CREATE TABLE automation_logs (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  queue_id UUID REFERENCES automation_queue(id),
  post_id UUID REFERENCES posts(id),
  status TEXT NOT NULL,              -- success | draft | held | error
  confidence_score INT,
  seo_checks_passed INT,             -- out of 13
  revision_notes TEXT,
  error_message TEXT,
  created_at TIMESTAMPTZ DEFAULT now()
);
```

**Existing Supabase Storage bucket:** `post-images` (public) — already created.

---

## Environment Variables (New Project)

```env
# OpenAI
OPENAI_API_KEY=

# Google Gemini
GEMINI_API_KEY=

# Jesse A. Eisenbalm Blog API (automation, creates published posts)
BLOG_API_KEY=adb66a122a92b46278069f15d1d5b376103d80ea54745e0a29317896261cced8
BLOG_API_URL=https://jesse-eisenbalm-server.vercel.app

# Admin password (for image uploads via /api/admin/upload)
ADMIN_PASSWORD=

# Supabase (reuse existing project for queue + logs)
SUPABASE_URL=https://kqyiauyahlmruyblxezp.supabase.co
SUPABASE_SERVICE_ROLE_KEY=

# Dashboard auth
DASHBOARD_PASSWORD=

# Schedule (cron syntax — default: 6am daily)
CRON_SCHEDULE=0 6 * * *

# Publishing thresholds (0–100)
AUTO_PUBLISH_THRESHOLD=85
DRAFT_THRESHOLD=70
```

---

## Project Structure

```
jesse-eisenbalm-automation/
├── agents/
│   ├── supervisorAgent.js      # Orchestration logic + publish decision
│   ├── contentAgent.js         # SEO Content Generator (Yoast-compliant output)
│   ├── revisionAgent.js        # 13-check Yoast audit + confidence scoring
│   └── imageAgent.js           # Gemini generation + /api/admin/upload
├── dashboard/
│   ├── src/                    # React dashboard
│   └── public/
├── services/
│   ├── blogApi.js              # POST /api/posts wrapper
│   ├── uploadApi.js            # POST /api/admin/upload wrapper
│   ├── supabase.js             # Supabase client (queue + logs)
│   └── scheduler.js            # node-cron setup
├── prompts/
│   ├── contentPrompt.js        # System + user prompts for content agent
│   ├── revisionPrompt.js       # 13-check Yoast revision prompt
│   └── brandContext.js         # Shared brand context injected into all agents
├── .env
├── package.json
└── index.js                    # Entry point
```

---

## Getting Started (New Project Setup)

1. Create a new repo: `jesse-eisenbalm-automation`
2. Run `npm init -y`
3. Install dependencies:
   ```bash
   npm install openai @google/generative-ai @supabase/supabase-js node-cron express dotenv
   ```
4. Copy `.env` and fill in all keys
5. Add `automation_queue` and `automation_logs` tables to Supabase (SQL above)
6. `post-images` Supabase Storage bucket is **already created and public** — no action needed
7. Run `node index.js` to start scheduler + dashboard server
8. Deploy to Vercel

---

## Revision Agent Prompt (Reference)

Use this as the base system prompt for the Revision Agent:

```
You are an SEO editor. You will receive a blog post draft and a focus keyphrase.
Audit the draft against the following 13 Yoast SEO checks and return an improved version.

CHECKS (score 1 point each):
1. Focus keyphrase appears in the title
2. Focus keyphrase appears in the URL slug
3. Focus keyphrase appears in the meta description (excerpt)
4. Focus keyphrase appears in the first paragraph
5. Focus keyphrase appears in at least one H2 heading
6. Keyphrase density is between 0.5% and 3% of total words
7. Word count is at least 300 (target 900+)
8. Content contains at least one H2 subheading
9. Title is 50–60 characters
10. Excerpt is 150–160 characters
11. At least 1 internal link to jesseaeisenbalm.com
12. At least 1 external link to a credible source
13. All <img> tags have non-empty alt attributes

Return JSON:
{
  "title": "...",
  "excerpt": "...",
  "content": "...",
  "tags": [...],
  "confidence_score": 0-100,
  "seo_checks_passed": 0-13,
  "revision_notes": "Brief summary of changes made"
}

Brand voice: calm, minimal, philosophical. Never corporate. Never hyperbolic.
CTA: always end with a link to https://jesseaeisenbalm.com
```

---

## Security Notes

- `BLOG_API_KEY` only allows creating posts — it cannot read payments, customer data, or delete posts
- `ADMIN_PASSWORD` is verified server-side only — never sent to a browser or embedded in client code
- `SUPABASE_SERVICE_ROLE_KEY` has full DB access — keep it server-side only
- `DASHBOARD_PASSWORD` protects the automation dashboard's publish controls — use a strong passphrase
- All secrets stay server-side; the dashboard frontend communicates only with the automation backend
